# Архитектурные правила
SYS-01: Домены - центр системы, адаптеры тонкие.

ADAPTER-01: 1 handler -> 1 facade operation. Один REST endpoint или MQTT consumer вызывает ровно одну публичную операцию Facade. Если нужно несколько доменных операций/доменов - создается отдельная composite use-case операция в фасаде.

USECASE-01: Composite use-case размещается в фасаде домена-владельца сценария, который выбирается исходя из наиболее специфической характеристики реализуемой функции.

DOMAIN-01: Каждый домен имеет один публичный Facade как единственную точку входа.
DOMAIN-02: Внешний импорт внутренних классов (кроме *Facade и подпакета contract) домена другими доменами/адаптерами запрещен.
DOMAIN-03: Каждый домен организован так: 
   - public Facade размещается в корне пакета `ru.growerhub.backend.<domain>` (имя класса `*Facade`), 
   - подпакет public `contract` - контракты (DTO/records/enums),
   - подпакет `engine` - бизнес-логику (use-case/сервисы),  
   - подпакет `jpa` - сущности/репозитории.
Контроллеры/фильтры/конфиги/initializers/resources/gateways реализации не должны жить в домене: их место в адаптерах (`api`, `mqtt`) или конфигурации приложения.
DOMAIN-04: Домен не зависит от адаптеров (api/mqtt).
DOMAIN-05: Домен эксклюзивно владеет своими JPA entity/Repository. Другие домены не имеют права импортить чужие *.jpa.. и выполнять запросы к чужим таблицам через EntityManager/JdbcTemplate/Repository. Междоменные связи — только через id и фасады.

CONFIG-01: Параметры доменов и подсистем размещаются только в application.yml и читаются через @ConfigurationProperties классы в ru.growerhub.backend.common.config.<domain>.
Параметрами считаются таймауты, интервалы, лимиты, пороги, дефолтные значения, флаги поведения и строки окружения (URL/paths/topics).
Домены не хардкодят такие значения в static final или “магических числах”; вместо этого получают настройки через DI в Facade/engine.
Низкоуровневые технические константы (например размеры буферов, протокольные идентификаторы и единичные математические коэффициенты) допускается оставлять в коде, если они не являются параметрами окружения.

COMMON-01: common содержит только стабильные типы/DTO/утилиты. бизнес-логика и JPA entity запрещены. Допускается подпакет ru.growerhub.backend.common.config как инфраструктурный wiring/config слой приложения (Spring Configuration/ConfigurationProperties/security), без бизнес-логики и без JPA.

ADAPTER-02: Адаптеры не содержат бизнес-логики.

ERROR-01: Исключения/ошибки в домене мапятся на границе адаптера (API/MQTT). Домен бросает DomainException с кодом.

TRANSACTION-01: Транзакционные границы задаются и контролируются только на уровне операций facade. Пакеты engine и jpa работают в контексте транзакции, открытой фасадом; адаптеры не открывают собственных транзакций.

CHANGE-01: Если фича не укладывается в RULES - сначала предложение изменения архитектуры/правил; ADR только если это исключение.

COMMENTS-01: Все комментарии в коде и changelog должны быть записаны на русском языке транслитом
COMMENTS-02: Каждый публичный метод Facade обязан иметь JavaDoc
COMMENTS-03: Все коммиты должны сопровождаться описанием на английском языке
COMMENTS-04: Описание всех проделанных работ добавляется в начало CHANGELOG.md в соответсвующем подпроекте (backend/firmware/frontend) с указанием даты в формате (##  YYYY-MM-DD)
COMMENTS-05 Каждый параметр в application.yml должен иметь однострочный комментарий # с пояснением назначения.

