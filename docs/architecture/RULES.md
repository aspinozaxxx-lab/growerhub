# Архитектурные правила

1. R-SYS-01: Домены - центр системы, адаптеры тонкие.
2. R-ADAPTER-01: 1 handler -> 1 facade operation. Один REST endpoint или MQTT consumer вызывает ровно одну публичную операцию Facade. Если нужно несколько доменных операций/доменов - создается отдельная composite use-case операция в фасаде/оркестраторе; адаптер все равно делает один вызов.
3. R-USECASE-01: Composite use-case размещается в фасаде домена-владельца сценария. Если владельца нет, вводится домен orchestration; его Facade агрегирует вызовы других доменов. Адаптеры не вызывают несколько фасадов.
4. R-DOMAIN-01: Каждый домен имеет один публичный Facade как точку входа.
5. R-DOMAIN-02: Домены общаются только через Facade и контрактные типы. Прямой импорт внутренних классов домена другими доменами/адаптерами запрещен.
6. R-DOMAIN-03: Внутренности домена располагаются в internal/* и по возможности package-private.
7. R-DOMAIN-04: Домен не зависит от адаптеров (api/mqtt).
8. R-SHARED-01: shared/common располагается в пакете ru.growerhub.backend.common и содержит только стабильные типы/DTO/утилиты; бизнес-логика и JPA entity запрещены.
9. R-DB-01: JPA Entity/Repository не используются как междоменный контракт. Наружу только DTO/контрактные типы.
10. R-ADAPTER-02: Адаптеры не содержат бизнес-логики и не имеют прямого доступа к DB.
11. R-FACADE-01: Facade именуется <Domain>Facade и содержит только публичные операции use-case уровня.
12. R-CONTRACT-01: Контракты между подсистемами фиксируются в ARCHITECTURE и RULES; изменения контрактов требуют правки документов.
13. R-ERROR-01: Внутри домена допустимы доменные исключения/ошибки, но на границе адаптера они мапятся в контрактные коды/DTO.
14. R-TRANSACTION-01: Транзакционные границы задаются на уровне доменных операций Facade.
15. R-BOUNDARY-01: Запрещен импорт *.internal.* извне домена.
16. R-CHANGE-01: Если фича не укладывается в RULES - сначала предложение изменения архитектуры/правил; ADR только если это исключение.
