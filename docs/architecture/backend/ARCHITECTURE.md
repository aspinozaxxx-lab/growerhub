# Backend: целевая архитектура

Модель:
- Домены: device, plant, pump, sensor, journal, auth.
- Каждый домен имеет Facade (public API) и внутренности в internal/*.
- Shared/common: стабильные типы, общие DTO, утилиты.
- Адаптеры: REST API слой и MQTT слой - тонкие.

Определение домена:
Домен = Facade + internal + инфраструктура домена.

Домены и ответственность:
- device: устройства, идентификация, статусы и shadow.
- plant: растения и их жизненный цикл.
- pump: управление насосами и ручной полив.
- sensor: датчики и показания.
- journal: журнал действий/событий/истории.
- auth: пользователи и аутентификация.

Инфраструктура:
- DB (JPA) внутри доменов.
- MQTT publisher/subscriber - инфраструктура доменов через Facade.
- shadow/ack - кэши/хранилища производных состояний доменов.

Междоменные взаимодействия:
- Только через Facade и контрактные типы.
- Внутренние классы и JPA entity не пересекают границы.

Composite use-case:
- Размещается в фасаде домена-владельца сценария.
- Если владельца нет, вводится домен orchestration; его Facade агрегирует вызовы других доменов.

ASCII-схема:

[REST adapters]      [MQTT adapters]
       \                 /
        \               /
         +-------------+
         |  Facades    |
         +-------------+
                |
        +---------------+
        | domain internal|
        +---------------+
          |     |     |
         [DB] [shadow] [mqtt]

Shared/common доступен доменам и адаптерам только для контрактов и утилит.
