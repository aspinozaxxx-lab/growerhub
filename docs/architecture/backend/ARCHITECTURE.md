# Backend: целевая архитектура

- Модель:
- Домены: device, plant, pump, sensor, journal, auth, user.
- Каждый домен реализован как набор пакетов facade/contract/engine/jpa, где facade — публичная точка входа, contract — экспортируемые типы, а engine и jpa отвечают за бизнес-логику и постоянное хранение.
- Shared/common: стабильные типы, общие DTO, утилиты.
- Адаптеры: REST API слой и MQTT слой - тонкие.

Определение домена:
Домен = Facade + internal + инфраструктура домена.

- Домены и ответственность:
- device: устройства, идентификация, статусы и shadow.
- plant: растения и их жизненный цикл.
- pump: управление насосами и ручной полив.
- sensor: датчики и показания.
- journal: журнал действий/событий/истории.
- auth: аутентификация и авторизация (токены, методы входа, SSO).
- user: пользователи, профиль и админка пользователей.

Инфраструктура:
- DB (JPA) внутри доменов.
- MQTT publisher/subscriber - инфраструктура доменов через Facade.
- shadow/ack - кэши/хранилища производных состояний доменов.

Междоменные взаимодействия:
- Только через Facade и контрактные типы.
- Внутренние классы и JPA entity не пересекают границы.

-Composite use-case:
- Размещается в фасаде домена-владельца сценария.
- Если явного владельца нет, фасад одного из вовлечённых доменов агрегирует нужные вызовы.

ASCII-схема:

[REST adapters]      [MQTT adapters]
       \                 /
        \               /
         +-------------+
         |  Facades    |
         +-------------+
                |
        +---------------+
        | domain internal|
        +---------------+
          |     |     |
         [DB] [shadow] [mqtt]

Shared/common доступен доменам и адаптерам только для контрактов и утилит.
