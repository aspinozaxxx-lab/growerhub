# Changelog

В этом файле фиксируются изменения проекта. Используем формат Keep a Changelog и Semantic Versioning.

## [2025-10-24]

### Добавлено
- Добавлены проверки состояния DeviceShadowStore перед start/stop в API ручного полива (409 при неверном статусе).
- Добавлен эндпоинт GET /api/manual-watering/wait-ack для мягкого ожидания подтверждения команд.
- Добавлены поля is_online и last_seen_at в GET /api/manual-watering/status.
- Поле offline_reason поясняет причину блокировки кнопок (device_offline/no_state_yet/None).
- Добавлена документация docs/manual_watering_protocol.md с описанием протокола.
- Добавлено подробное логирование MQTT-подписчиков (state и ack): подключение, входящие сообщения, ошибки парсинга.
- Добавлен отладочный эндпоинт GET /_debug/manual-watering/snapshot (только при DEBUG=True) для просмотра сырых данных устройства в памяти сервера.

### Изменено
- Перенёс manual_watering.html из server/static в static/.
- Обновил интерфейс ручного полива: поддержка is_online и last_seen_at, использование wait-ack вместо частого опроса,
  блокировка кнопок при оффлайне, улучшенный прогресс-бар и уведомления.
- Страница manual_watering.html сразу после ввода device_id запрашивает статус, активирует кнопки только для онлайн-устройств
  и поясняет сценарии онлайн/оффлайн/устройство не найдено прямо в UI.
- Введён флаг DEBUG в настройках; сервисные отладочные ручки доступны только при DEBUG=True.
- GET /api/manual-watering/status теперь отдаёт 200 c заглушкой, даже если state ещё не приходил — фронтенд блокирует кнопки аккуратно.

### Исправлено
- Устранены проблемы с расчётом remaining_s и синхронизацией ACK в тестах.
- Тесты обновлены с учётом режима DEBUG.

### Цель
- Упростить диагностику, почему UI видит "нет данных ❓".

## [2025-10-23]

### Добавлено
- Начальная настройка прошивки и вспомогательных скриптов (firmware/config.ini, scripts/post_upload.py и др.).

### Изменено
- Настроена работа прошивки с EEPROM и интеграция с SPIFFS.

### Исправлено
- Скорректированы API Wi-Fi и OTA для поддержки новых сценариев прошивки.
