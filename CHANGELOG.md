# Changelog

## [2025-10-24] MQTT step 3

- Добавлена публикация ACK в MQTT-топик устройства `gh/dev/ESP32_2C294C/ack` после обработки команд ручного полива.
- После `pump.start` и `pump.stop` контроллер отвечает с `correlation_id`, `result` и `status`, что даёт серверу подтверждение для фронтенда через `/api/manual-watering/wait-ack`.
- Ошибки формата (например, отсутствует `duration_s` или `type`) теперь возвращают `result=error` и поле `reason` с описанием проблемы.
- ACK публикуется без retain, так как это одноразовое подтверждение; публикация состояния устройства (state с retain) будет добавлена на следующем шаге.

## [2025-10-24] MQTT step 2

- Реализован разбор JSON-команд `pump.start` и `pump.stop`, добавлены подробные логи для отладки цепочки сервер → устройство.
- Насос управляется через существующий контроллер реле, сохраняется локальное состояние (running/idle, duration_s, correlation_id) для будущих ACK/state.
- В `loop()` добавлен автостоп по таймеру `duration_s`, чтобы исключить затяжной полив при потере связи.
- Публикация ACK и state запланирована на следующие шаги (шаг 3+).

## [2025-10-24] MQTT step 1

- Добавлено базовое подключение ESP32 к Wi-Fi (STA) и MQTT, использованы логин/пароль Mosquitto и clientId `ESP32_2C294C`.
- Устройство подписывается на командный топик `gh/dev/ESP32_2C294C/cmd` (QoS=1), логирует входящие сообщения в Serial и автоматически переподключается при обрыве.
- Управление насосом и публикация ack/state намечены на последующие шаги.
